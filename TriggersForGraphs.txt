
-- GRN NODES
	CALL apoc.trigger.add("addGrnToCreatedNodes", "UNWIND {createdNodes} AS n WITH n WHERE NOT exists(n.grn) SET n.grn = 'grn:gg:' + toLower(head(labels(n))) + ':' + apoc.text.random(44)", {phase: "before"})


-- GRN RELATIONSHIPS
	CALL apoc.trigger.add("addGrnToCreatedRelationships", "UNWIND {createdRelationships} AS r WITH r WHERE NOT exists(r.grn) SET r.grn = 'grn:gg:' + toLower(type(r)) + ':' + apoc.text.random(44)", {phase: "before"})


-- FORCE INDEX PROPERTIES
CALL apoc.trigger.add("forceIndexProperties", "UNWIND {createdNodes} AS n WITH n SET n.lastSearchIndexedAt='0' WITH n WHERE n.updatedAt IS NULL SET n.updatedAt=replace(replace(toString(apoc.date.format(timestamp(),'ms','yyyy-MM-dd HH:mm:ssZ')),' ','T'),'+0000','+00:00')", {phase: "before"})